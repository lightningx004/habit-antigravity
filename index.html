<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0b0b0b">
    <title>Habit & Task Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
</head>

<body>

    <div class="main-container">
        <!-- SETTINGS BUTTON (Moved here for positioning) -->
        <button id="openSettingsBtn" class="settings-float-btn">‚öôÔ∏è</button>

        <div class="top-bar-card">
            <div class="year-info">
                <span class="year-label" id="yearLabel">2026 Progress</span>
            </div>
            <div class="year-progress-track">
                <div class="year-progress-fill" id="yearBarFill"></div>
            </div>
            <span class="year-percent" id="yearPercent">0%</span>
        </div>

        <div class="dashboard-grid">

            <div class="col-left">
                <div class="card month-card">
                    <h3>Month</h3>
                    <div class="small-circular-progress" id="monthCircle">
                        <span class="small-progress-value" id="monthText">0%</span>
                    </div>
                </div>

                <div class="card calendar-card">
                    <div class="calendar-header">
                        <button id="prevMonth">&lt;</button>
                        <h2 id="monthYear">JANUARY 2026</h2>
                        <button id="nextMonth">&gt;</button>
                    </div>

                    <div class="weekdays">
                        <div>S</div>
                        <div>M</div>
                        <div>T</div>
                        <div>W</div>
                        <div>T</div>
                        <div>F</div>
                        <div>S</div>
                    </div>

                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <div class="col-center">
                <div class="card today-card">
                    <h3>DAILY PROGRESS</h3>
                    <div class="large-circular-progress" id="progressCircle">
                        <div class="inner-circle">
                            <span class="large-progress-value" id="progressText">0%</span>
                            <span class="fraction-value" id="fractionText">0/0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-right">
                <div class="card habits-card">
                    <div class="habits-header">
                        <h3>Your Schedule <span style="font-size:0.6rem; opacity:0.5;">(v2.2)</span></h3>
                        <button id="openModalBtn" class="header-add-btn">+</button>
                    </div>

                    <ul class="habit-list" id="habitList">
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <div class="modal-overlay" id="addHabitModal">
        <div class="modal-card">
            <h3>Add Item</h3>

            <div class="input-group">
                <label>New Habit <small>(Repeats Every Day)</small></label>
                <input type="text" id="modalHabitInput" placeholder="">
            </div>

            <div style="width:100%; height:1px; background:#333; margin:10px 0;"></div>

            <div class="input-group">
                <label>New Task <small>(Only for Selected Date)</small></label>
                <input type="text" id="modalTaskInput" placeholder="">
            </div>

            <div class="modal-actions">
                <button id="cancelBtn" class="btn-cancel">Cancel</button>
                <button id="confirmAddBtn" class="btn-confirm">Add</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-card">
            <h3>Data Settings</h3>
            <p style="text-align:center; color:#aaa; font-size:0.85rem; margin-bottom:20px;">
                Backup your data to a file or restore it on another device.
            </p>

            <div class="input-group">
                <button id="exportBtn" class="btn-confirm" style="width:100%; margin-bottom:10px;">
                    Download Backup (Export)
                </button>

                <button id="triggerImportBtn" class="btn-cancel" style="width:100%;">
                    Restore from Backup (Import)
                </button>
                <input type="file" id="importFile" accept=".json" style="display:none;">
            </div>

            <div style="width:100%; height:1px; background:#333; margin:20px 0;"></div>

            <button id="closeSettingsBtn" class="btn-cancel" style="width:100%;">Close</button>
        </div>
    </div>



    <script src="script.js"></script>
</body>

</html>
<script>
    // --- VARIABLES ---
    const scheduleCard = document.getElementById('schedule-card');
    const calendarGrid = document.getElementById('calendarGrid');
    const monthDisplay = document.getElementById('monthDisplay');
    const habitList = document.getElementById('habitList');
    const plusBtn = document.querySelector('.plus-btn');

    const today = new Date();
    let selectedDate = new Date(); // Tracks which day is open

    // --- 1. CALENDAR LOGIC ---
    function renderCalendar() {
        const year = today.getFullYear();
        const month = today.getMonth();
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        monthDisplay.innerText = `${monthNames[month]} ${year}`;

        const firstDayIndex = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let paddingDays = firstDayIndex === 0 ? 6 : firstDayIndex - 1;

        calendarGrid.innerHTML = "";

        // Padding (Empty slots)
        for (let i = 0; i < paddingDays; i++) {
            calendarGrid.appendChild(document.createElement('span'));
        }

        // Days
        for (let i = 1; i <= daysInMonth; i++) {
            const dateBtn = document.createElement('span');
            dateBtn.innerText = i;
            dateBtn.classList.add('date');

            const thisDate = new Date(year, month, i);

            // Highlight Today
            if (i === today.getDate()) dateBtn.classList.add('active');

            dateBtn.addEventListener('click', () => {
                document.querySelectorAll('.date').forEach(d => d.classList.remove('selected'));
                dateBtn.classList.add('selected');
                updateScheduleMode(thisDate);
            });

            calendarGrid.appendChild(dateBtn);
        }
    }

    // --- 2. MODE SWITCHER (Past/Future/Today) ---
    function updateScheduleMode(clickedDate) {
        selectedDate = clickedDate; // Remember the date

        scheduleCard.classList.remove('past-mode', 'future-mode');

        const checkDate = new Date(clickedDate).setHours(0, 0, 0, 0);
        const currentDate = new Date(today).setHours(0, 0, 0, 0);

        if (checkDate < currentDate) {
            // PAST: Locked
            scheduleCard.classList.add('past-mode');
        } else if (checkDate > currentDate) {
            // FUTURE: "Add Only" Mode
            scheduleCard.classList.add('future-mode');
        }
    }

    // --- 3. ADD NEW HABIT FUNCTION ---
    plusBtn.addEventListener('click', () => {
        // Check if we are in PAST mode (cannot add to past)
        if (scheduleCard.classList.contains('past-mode')) return;

        // Create new item HTML
        const li = document.createElement('li');
        li.className = 'habit-item';
        li.setAttribute('draggable', 'false'); // Locked by default

        li.innerHTML = `
                <div class="habit-left">
                    <div class="custom-checkbox"></div>
                    <span class="habit-text">New Habit</span>
                </div>
                <div class="habit-right">
                    <div class="streak-pill">üî• 0</div>
                    <span class="delete-btn">√ó</span>
                </div>
            `;

        // Add to list
        habitList.appendChild(li);

        // Re-initialize events for the new item
        initItemEvents(li);
    });


    // --- 4. ITEM INTERACTION (Check, Drag, Delete) ---
    let pressTimer;

    function initItemEvents(habit) {
        const checkbox = habit.querySelector('.custom-checkbox');
        const deleteBtn = habit.querySelector('.delete-btn');

        // Toggle Checkbox
        checkbox.onclick = (e) => {
            // SECURITY CHECK: If in future mode, STOP immediately.
            if (scheduleCard.classList.contains('future-mode')) return;

            e.stopPropagation();
            habit.classList.toggle('checked');

            if (habit.classList.contains('checked')) {
                checkbox.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
            } else {
                checkbox.innerHTML = '';
            }
        };

        // Delete Item
        deleteBtn.onclick = (e) => {
            // SECURITY CHECK: If in future mode, STOP.
            if (scheduleCard.classList.contains('future-mode')) return;

            e.stopPropagation();
            habit.remove();
        };

        // Long Press to Drag
        habit.addEventListener('mousedown', (e) => {
            // STOP if clicking buttons OR if in Future Mode
            if (e.target.closest('.delete-btn') ||
                e.target.closest('.custom-checkbox') ||
                scheduleCard.classList.contains('future-mode')) return;

            pressTimer = setTimeout(() => {
                habit.classList.add('unlocked');
                habit.setAttribute('draggable', 'true');
            }, 500);
        });

        habit.addEventListener('mouseup', () => clearTimeout(pressTimer));
        habit.addEventListener('mouseleave', () => clearTimeout(pressTimer));

        habit.addEventListener('dragstart', (e) => {
            if (scheduleCard.classList.contains('future-mode')) {
                e.preventDefault();
                return;
            }
            habit.classList.add('dragging');
            habit.classList.remove('unlocked');
        });

        habit.addEventListener('dragend', () => {
            habit.classList.remove('dragging');
            habit.classList.remove('unlocked');
            habit.setAttribute('draggable', 'false');
        });

    }

    // Initialize existing items
    document.querySelectorAll('.habit-item').forEach(initItemEvents);

    // Sorting Engine
    habitList.addEventListener('dragover', (e) => {
        e.preventDefault();
        const draggingItem = document.querySelector('.dragging');
        if (!draggingItem) return;

        const siblings = [...habitList.querySelectorAll('.habit-item:not(.dragging)')];
        const nextSibling = siblings.find(sibling => {
            return e.clientY <= sibling.getBoundingClientRect().top + sibling.getBoundingClientRect().height / 2;
        });
        habitList.insertBefore(draggingItem, nextSibling);
    });

    // Start App
    renderCalendar();
    // Prevent Right Click
    document.addEventListener('contextmenu', event => event.preventDefault());

</script>